{template 'common/header'}
<link rel="stylesheet" type="text/css" href="../addons/str_takeout/template/resource/css/main.css">
<script src="../addons/str_takeout/template/resource/js/dialog.js"></script>
<style type="text/css">
	.but-post{display:block;height:30px;line-height:30px;border:none;width:640px;border-radius:3px;font-size:16px;font-weight:bold;color:#fff;background-color:#ff5f32;}
</style>
<div class="container">
	<section>
		{if ($order['status'] == 2)}
			<h2 class="order_detail_tt">逾期未支付订单会自动取消</h2>
		{/if}
		<ul class="my_order">
			<li>
				<a href="{php echo $this->createMobileUrl('store', array('sid' => $sid))}">
					<div>
						{if $order['status'] == 1}
							<div class="ico_status complete"><i></i>已完成</div>
						{elseif $order['status'] == 2}
							<div class="ico_status pending"><i></i>待付款</div>
						{elseif $order['status'] == 3}
							<div class="ico_status inhand"><i></i>待送餐</div>
						{elseif $order['status'] == 6}
							<div class="ico_status confirm"><i></i>送餐中</div>
						{elseif $order['status'] == 4}
							<div class="ico_status confirm"><i></i>待收餐</div>
						{elseif $order['status'] == 5}
							<div class="ico_status cancle"><i></i>已取消</div>
						{/if}
					</div>
					<div>
						<h3 class="highlight">{$store['title']}</h3>
						<p>{$order['num']}份/￥{$order['price']}</p>
						<div>{php echo date('Y-m-d H:i', $order['addtime']);} {php echo date('', $order['addtime'])}</div>
					</div>
					<div class="w14"><i class="ico_arrow"></i></div>
				</a>
			</li>
		</ul>
		<div class="detail_tools">
			{if ($order['status'] == 2)}
				<div><a href="{php echo $this->createMobileUrl('pay', array('id' => $order['id']))}" class="comm_btn">立即付款(还剩{$minute}分钟)</a></div>
			{/if}
			{if ($order['status'] == 6) || ($order['pay_type'] == 'delivery')}
				<div><a href="javascript:void(0);" class="comm_btn" id="confirmBtn">确认送达</a></div>
			{/if}
			{if ($order['status'] == 1)}
				<div><a href="javascript:void(0);" class="normal_link" id="deleteOrder">删除订单</a></div>
				<div><a href="{php echo $this->createMobileUrl('comment', array('id' => $oid))}" class="comm_btn">{if $order['comment'] == 1}查看评分{else}我要评分{/if}</a></div>
			{/if}
		</div>
		<style type="text/css">
			.my_menu_list th{width:0;}
		</style>
		<table class="my_menu_list">
			<thead>
				<tr>
					<th style="width:430px">美食列表</th>
					<th style="width:60px">{$order['num']}份</th>
					<th style="width:150px"><strong class="highlight">￥{$order['price']}</strong></th>
				</tr>
			</thead>
			<tbody>
				{if !empty($order['dish'])}
					{loop $order['dish'] $da}
						<tr>
							<td>{$da['title']}</td>
							<td>X{$da['num']}</td>
							<td>￥{$da['price']}</td>
						</tr>
					{/loop}
				{/if}
			</tbody>
		</table>
		<ul class="box">
			<li>预定人：{$order['username']}</li>
			<li>手机：{$order['mobile']}</li>
			<li>送餐地址：{$order['address']}</li>
			<li>送餐时间：{if $order['delivery_time']}{$order['delivery_time']}{else}尽快送出{/if}</li>
			<li>支付方式：{$pay_types[$order['pay_type']]}</li>
			<li>订单状态：
				{if $order['status'] == 1}
					已完成
				{elseif $order['status'] == 2}
					待付款
				{elseif $order['status'] == 3}
					待送餐
				{elseif $order['status'] == 4}
					待收餐
				{elseif $order['status'] == 5}
					已取消
				{elseif $order['status'] == 6}
					送餐中
				{/if}
			</li>
		</ul>
		<ul class="box">
			<li>备注</li>
			<li>{if $order['note']}{$order['note']}{else}无{/if}</li>
		</ul>
		<div class="my_order_tips">如需取消订单，请与商家联系，谢谢！</div>
	</section>
	<footer class="order_btns">
		<div class="fixed">
			<a href="{php echo $this->createMobileUrl('index');}"><i class="ico_takeout"></i>叫外卖</a>
			<a href="{php echo $this->createMobileUrl('myorder');}" class="on"><i class="ico_order"></i>我的订单</a>
		</div>
	</footer>
</div>
<div class="confirm_box" id="confirmBox">
	<p>您确定已经收到该餐厅的外卖了吗？</p>
	<div>
		<span><a href="javascript:void(0);" class="comm_btn disabled" id="cancelConfirmDelivery">未收到</a></span>
		<span><a href="javascript:void(0);" class="comm_btn" id="confirmDelivery">已收到</a></span>
	</div>
</div>
<div class="dialog mask" style="display: none;">
	<div class="dialog_wrap">
		<div class="dialog_tt">确认删除订单</div>
		<div class="dialog_scroller"><div class="confirm_box dialog_content" id="confirmBox2" style="display: block;">
			<p>您确定要删除订单？</p>
		<div>
		<span><a href="javascript:void(0);" class="comm_btn disabled" id="cancelConfirmDelete">取消</a></span>
		<span><a href="" class="comm_btn" id="confirmDelete">确认删除</a></span>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		$('#confirmBtn').click(function(){
			$('#confirmBox').dialog({title: '确认送达'});
		});
		$("#cancelConfirmDelivery").click(function(){
			$('#confirmBox').dialog('close');
		});
		$("#confirmDelivery").click(function(){
			$.post("{php echo $this->createMobileUrl('ajaxorder', array('id' => $oid, 'op' => 'editstatus'))}",{},function(e){
				if(e.errno == 0) {
					location.reload();
				}else{
					alert(e.error);
					return false;
				}
			},"json");
		});

		$("#deleteOrder").click(function(){
			$('#confirmBox2').dialog({title: '确认删除订单'});
		});
		$("#cancelConfirmDelete").click(function(){
			$('#confirmBox2').dialog('close');
		});
		$("#confirmDelete").click(function(){
			$.post("{php echo $this->createMobileUrl('ajaxorder', array('id' => $oid, 'op' => 'del'))}",{},function(e){
				if(e.errno == 0) {
					location.href = e.error;
					return false;
				}else{
					alert(e.error);
					return false;
				}
			},"json");
		});
	});
	document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
		WeixinJSBridge.call('hideOptionMenu');
	});
</script>
{template 'common'}
{template 'common/footer'}
