(function(a){a.fn.upload=function(k){var g={dom:this,action:"",params:{},onChooseFile:false,onSubmit:false};g=a.extend(g,k);var c=a(g.dom).width();var j=a(g.dom).height();var f=a('<input type="file"/>');f.attr({accept:"image/jpeg,image/png",name:"file"});if(g.onSubmit){var h="upload_icon_iframe_"+parseInt(Math.random()*100),b=a("<form></form>"),d=a("<iframe style='display:none;'></iframe>");d.attr({name:h,id:h});b.attr({action:g.action,enctype:"multipart/form-data",method:"post",target:h});for(var e in g.params){var i=a("<input type='hidden'/>").attr({name:e,value:g.params[e]});b.append(i);i=null}f.appendTo(b);b.append(d);d.on("load",function(){var l=a(this.contentDocument.body).text();if(l.indexOf("{")>0){g.onSubmit(a.parseJSON(l))}else{if(l.length>4){g.onSubmit({re:1,path:l})}else{if(l==""){return}else{g.onSubmit({re:l})}}}});f.css({position:"absolute",width:"100%",height:"100%",left:0,top:0,right:0,bottom:0,opacity:0});b.css({position:"absolute",width:"100%",height:"100%",left:0,top:0,right:0,bottom:0});a(g.dom).css({position:"relative",overflow:"hidden"});a(g.dom).append(b)}else{f.css({position:"absolute",width:"100%",height:"100%",left:0,top:0,right:0,bottom:0,opacity:0});a(g.dom).css({position:"relative",overflow:"hidden"}).append(f)}f.on("change",function(){var l=false;if(this.files[0]&&this.value.toLocaleString().match("^.*.[jpg|png]$")){if(g.onChooseFile){var m=new Image();window.URL=window.URL||window.webkitURL;if(window.URL){m.src=window.URL.createObjectURL(this.files[0]);m.onload=function(n){window.URL.revokeObjectURL(this.src)}}else{if(this.files[0].getAsDataURL){m.src=this.files[0].getAsDataURL()}}g.onChooseFile(m,this)}if(g.onSubmit){b.submit()}}})}})(Zepto);