<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="Croaker" name="author">
<meta name="Description" content="{$reply['description']}" />
<meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
<meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
<meta content="no-cache" http-equiv="pragma">
<meta content="0" http-equiv="expires">
<meta content="telephone=no, address=no" name="format-detection">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
<link href="../addons/stonefish_scratch/template/css/square.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../addons/stonefish_scratch/template/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="../addons/stonefish_scratch/template/js/WeixinApi.js"></script>	
<script type="text/javascript" src="../addons/stonefish_scratch/template/js/wScratchPad.js"></script>
<title>{$reply['title']}</title>
<script>
$(document).ready(function() {
	//if(parseInt($("#nums").html())>0){
		var baseurl = $("#baseurl").val();
		var isplayed = false;
		var datatip;
		$('.wipe').wScratchPad({
			bg: baseurl+'template/images/touming.png',
			fg: baseurl+'template/images/wipe.png',
			scratchDown: function (e, percent) {
				if(percent>0){
					if(!isplayed){
						if(datatip.success==1||datatip.success==0){
						    if(datatip.success==1){
							    $('#awardname').html(datatip.award['prizetype']+"-"+datatip.award['prizename']);
							    $("#panelimg").css({"background-image": "url("+datatip.award['prizepic']+")"});
							    $("#cccc").text(datatip.award['prizetype']+"-"+datatip.award['prizename']);
							}
							if(datatip.success==0){
							    $('#awardname').html(datatip.msg);
							}
							if($("#credit_now").length>0){
						        $("#credit_now").text(parseInt($("#credit_now").text())-{$reply['credit_times']});
						    }
						    if($("#count").length>0){
						    	$("#count").text(parseInt($("#count").text())+1);
						    }
						    if($("#totalcount").length>0){
							    $("#totalcount").text(parseInt($("#totalcount").text())+1)
						    }
						    if($("#number_times").length>0){
							    $("#number_times").text(parseInt($("#number_times").text())-1);
						    }
						    $("#panel-content").css({"height": ""+datatip.height+"px"});
						}						
					}
					isplayed = true;
				}
				if (percent > 50) {
					this.reset();
					if(datatip.success==1){
					    $("#panel_box").show();
						$("#wipestart").show();
					    $("#credit_now").text(datatip.credit_now);
						$("#result_info1").show();
						$("#result_info2").hide();
					}else{
					    $("#panelimg").css({"background-image": "url(../addons/stonefish_scratch/template/images/icon_prize_useless.png)"});
						$("#cccc").text(datatip.msg);					   
					    $("#panel_box").show();
						$("#wipestart").show();
					    $("#credit_now").text(datatip.credit_now);
						$("#result_info1").hide();
						$("#result_info2").show();
					}
					if(datatip.isfans){
					    $("#result_info").show();
					    $("#result_info1").hide();
						$("#result_info2").hide();
				    }else{
					    $("#result_info").hide();
				    }
				}
			}
		});
	//}
	$("#wipestart").click(function(){
	    if ($("#msg").val()!=''){
		    $("#panelimg").css({"background-image": "url(../addons/stonefish_scratch/template/images/icon_prize_useless.png)"});
			$("#cccc").text($("#msg").val());			
			$("#panel_box").show();
			$("#result_info1").hide();
			$("#result_info2").show();
		}else{
		    $("#wipestart").hide();
			$.ajax({
				type: "get",
				dataType:'json',
				url: '{php echo $this->createMobileUrl('get_award', array('rid' => $rid))}',
				success: function(data) {						        
					datatip = data;
					if(datatip.success==2){
						$("#wipestart").show();
						$("#panelimg").css({"background-image": "url(../addons/stonefish_scratch/template/images/icon_prize_useless.png)"});
						$("#cccc").text(datatip.msg);
					    $("#panel_box").show();
						$("#result_info1").hide();						
						$("#result_info2").show();
						$("#msg").val(datatip.msg);
					}
				}
			});
		}
		
	});
	$("#shareimg").click(function(){
		$("#pop_share").fadeToggle();
	});
	$("#pop_share").click(function(){
		$("#pop_share").fadeToggle();
	});
	$("#panel-close").click(function(){
		$("#panel_box").hide();		
		isplayed = false;
		percent = 0;		
	});
	$("#savebtn").click(function(){
		$("#panel_box").hide();
		isplayed = false;
		percent = 0;
	});
	$("#closebtn").click(function(){
		$("#panel_box").hide();
		isplayed = false;
		percent = 0;
	});
	$("#share_close").click(function(){
		$("#share_box").hide();
	});
	$("#sharebtn").click(function(){
		$("#share_box").hide();
	});
});
</script>
</head>
<body onselectstart="return true;" ondragstart="return false;">
<input type="hidden" value="../addons/stonefish_scratch/" id="baseurl"/>
<input type="hidden" value="{$msg}" id="msg"/>
<div style="max-width:500px;">
    <div class="nou">
	    <div style="max-width:100%">
		{if !empty($reply['adpic'])}{if !empty($reply['adpicurl'])}<a href="{$reply['adpicurl']}">{/if}<img id="top_img" style="max-width: 100%;height: auto;width: auto\9;"  src="{php echo toimage($reply['adpic'])}" width="100%" border="0">{if !empty($reply['adpicurl'])}</a>{/if}{/if}
        </div>       
        <div class="zhuan1" id="lottery">
		    {if $reply['opportunity']==2}
			<div class="mingdan">
                <div class="biaoti">我的{$creditnames} <span class="n" id="credit_now">{php echo intval($credit[$reply['credit_type']])}</span> 个  每次 <span class="n">{$reply['credit_times']}</span> {$creditnames}</div>
            </div>
			{/if}
			{if $reply['opportunity']==1}
			<div class="mingdan">
                <div class="biaoti"> 赠送 <span class="n">{$reply['number_times']}</span> 次抽奖机会 剩余 <span class="n" id="number_times">{php echo $reply['number_times']-$fans['totalnum']}</span> 次</div>
            </div>
			{/if}
			{if $reply['opportunity']==0}
			<div class="mingdaninfo">
				<div class="box">					
					<div class="Detail" style="color:#FFF;text-align:center;">{$detail}</div>
				</div>
            </div>
			{/if}
			<div class="con">
			<div class="guagua">
			<div class="guaguabg">
		        <p style="display:table;height:100px;width:100%;">
			        <span style="z-index:999;display:table-cell;vertical-align:middle;" id="awardname"></span>
		        </p>
		        <div class="wipe" id="wipe"></div>
				<div class="wipestart" id="wipestart"><img src="../addons/stonefish_scratch/template/images/wipestart.png"></div>
	        </div>
			</div>
			</div>
			<div class="mingdan">
                <div class="biaoti">已有 <span class="n">{php echo $reply['xuninum']+$reply['fansnum']}</span> 人参与此活动</div>
            </div>
			{if !empty($award_list)&&$reply['awardnum']}
			<div class="mingdan">
                <div class="biaoti"><marquee behavior="scroll" scrolldelay="200">{$award_list}</marquee></div>
            </div>
			{/if}
			{if $share['sharenum']>0}
			<div class="boxwhite">
                <div id="shareimg" class="share"><img src="{$share['share_picurl']}"></div>
            </div>			
			{/if}
			<div style="height:55px;">&nbsp;&nbsp;</div>
        </div>
    </div>	
	<div class="panel-box" id="panel_box">
        <div class="panel-content" id="panel-content">
            <div class="panel-close" id="panel-close"></div>
            <span class="icon-prize-useless" id="panelimg"></span><br/><div id="cccc">{$reply['ticketinfo']}</div>
			<div id="result_info"{if !$isfans} style="display:none"{/if}>
			<div id="isfans" style="display:none">{$isfans}</div>
			    <hr class="common-hr" />
                {if $reply['isrealname']}<label>{$isfansname[0]}</label><input name="text" class="px" id="realname" value="{$profile['realname']}" type="text" placeholder="请输入{$isfansname[0]}">{/if}
				{if $reply['ismobile']}<label>{$isfansname[1]}</label><input name="tel" class="px" id="mobile" value="{$profile['mobile']}" type="text" placeholder="请输入{$isfansname[1]}">{/if}
				{if $reply['isqq']}<label>{$isfansname[2]}</label><input name="tel" class="px" id="qq" value="{$profile['qq']}" type="text" placeholder="请输入{$isfansname[2]}">{/if}
				{if $reply['isemail']}<label>{$isfansname[3]}</label><input name="email" class="px" id="email" value="{$profile['email']}" type="text" placeholder="请输入{$isfansname[3]}">{/if}
				{if $reply['isaddress']}<label>{$isfansname[4]}</label><input name="text" class="px" id="address" value="{$profile['address']}" type="text" placeholder="请输入{$isfansname[4]}">{/if}
				{if $reply['isgender']}<label>{$isfansname[5]}</label><select name="gender" id="gender" class="form-control">
						<option value="0"{if $profile['gender']==0} selected {/if}>选择{$isfansname[5]}</option>
						<option value="1"{if $profile['gender']==1} selected {/if}>男</option>
						<option value="2"{if $profile['gender']==2} selected {/if}>女</option>
					</select>{/if}
				{if $reply['istelephone']}<label>{$isfansname[6]}</label><input name="text" class="px" id="telephone" value="{$profile['telephone']}" type="text" placeholder="请输入{$isfansname[6]}">{/if}
				{if $reply['isidcard']}<label>{$isfansname[7]}</label><input name="text" class="px" id="idcard" value="{$profile['idcard']}" type="text" placeholder="请输入{$isfansname[7]}">{/if}
				{if $reply['iscompany']}<label>{$isfansname[8]}</label><input name="text" class="px" id="company" value="{$profile['company']}" type="text" placeholder="请输入{$isfansname[8]}">{/if}
				{if $reply['isoccupation']}<label>{$isfansname[9]}</label><input name="text" class="px" id="occupation" value="{$profile['occupation']}" type="text" placeholder="请输入{$isfansname[9]}">{/if}
				{if $reply['isposition']}<label>{$isfansname[10]}</label><input name="text" class="px" id="position" value="{$profile['position']}" type="text" placeholder="请输入{$isfansname[10]}">{/if}
                <div id="result_info_tip"></div>
				<div class="btn-layout">
                    <input type="reset" class="btn-reset" value="重填"/>
					<input class="btn-confirm" name="确定" id="save-btn" type="button" value="确定">
                </div>
            </div>
			<div id="result_info1" style="display:none">
			    <div style="margin-top:10px;"><input class="btn-confirm" name="放入百宝箱" id="savebtn" type="button" value="放入百宝箱"> </div>
			</div>
			<div id="result_info2" style="display:none">
			    <div style="margin-top:10px;"><input class="btn-confirm" name="关闭" id="closebtn" type="button" value="关闭"> </div>
			</div>
        </div>
    </div>
	<div class="panel-box" id="share_box">
        <div class="panel-content" id="panel-content">
            <div class="panel-close" id="share_close"></div>
            <div id="share_tip"></div>
			<hr class="common-hr" />			
			<div style="margin-top:10px;" id="share_miao"><input class="btn-confirm" name="关闭" id="sharebtn" type="button" value="关闭"> </div>
        </div>
    </div>
</div>
{if $share['sharenum']>0}<div id="pop_share"><img src="{$share['share_pic']}" width="100%" alt="分享到朋友圈"/></div>{/if}
{template 'footer'}
<script type="text/javascript">
        $("#save-btn").bind("click",function () {
            var btn = $(this);
            {if $reply['isrealname']}
			var realname = $("#realname").val();
            if (realname == '') {
				$("#result_info_tip").text("请输入{$isfansname[0]}");
                return
            }
			var partten = /[\u4e00-\u9fa5]/g;
            if(!partten.test(realname)){
               $("#result_info_tip").text("请输入正确的{$isfansname[0]}");
			   return;
            }
			{/if}
			{if $reply['ismobile']}
			var mobile = $("#mobile").val();
            if (mobile == '') {
                $("#result_info_tip").text("请输入{$isfansname[1]}");
                return
            }
			var partten = /^1\d{10}$/;
            if(!partten.test(mobile)){
               $("#result_info_tip").text("请输入正确的{$isfansname[1]}");
			   return;
            }
			{/if}
			{if $reply['isqq']}
			var qq = $("#qq").val();
            if (qq == '') {
                $("#result_info_tip").text("请输入{$isfansname[2]}");
                return
            }			
            var partten = /^[1-9]{1}\d{4,11}$/;
            if(!partten.test(qq)){
               $("#result_info_tip").text("请输入正确的{$isfansname[2]}");
			   return;
            }
			{/if}
			{if $reply['isemail']}
			var email = $("#email").val();
            if (email == '') {
                $("#result_info_tip").text("请输入{$isfansname[3]}");
                return
            }
			var partten = /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            if(!partten.test(email)){
               $("#result_info_tip").text("请输入正确的{$isfansname[3]}");
			   return;
            }
			{/if}
			{if $reply['isaddress']}
			var address = $("#address").val();
            if (address == '') {
                $("#result_info_tip").text("请输入{$isfansname[4]}");
                return
            }
			{/if}
			{if $reply['isgender']}
			var gender = $("#gender").val();
            if (gender == '0') {
                $("#result_info_tip").text("请选择{$isfansname[5]}");
                return
            }
			{/if}
			{if $reply['istelephone']}
			var telephone = $("#telephone").val();
            if (telephone == '') {
                $("#result_info_tip").text("请输入{$isfansname[6]}");
                return
            }
			{/if}
			{if $reply['isidcard']}
			var idcard = $("#idcard").val();
            if (idcard == '') {
                $("#result_info_tip").text("请输入{$isfansname[7]}");
                return
            }
			{/if}
			{if $reply['iscompany']}
			var company = $("#company").val();
            if (company == '') {
                $("#result_info_tip").text("请输入{$isfansname[8]}");
                return
            }
			{/if}
			{if $reply['isoccupation']}
			var occupation = $("#occupation").val();
            if (occupation == '') {
                $("#result_info_tip").text("请输入{$isfansname[9]}");
                return
            }
			{/if}
			{if $reply['isposition']}
			var position = $("#position").val();
            if (position == '') {
                $("#result_info_tip").text("请输入{$isfansname[10]}");
                return
            }
			{/if}
            var submitData = {
                    code: $("#sncode").text(),
                    {if $reply['isrealname']}realname: realname,{/if}
					{if $reply['ismobile']}mobile: mobile,{/if}
					{if $reply['isqq']}qq: qq,{/if}
					{if $reply['isemail']}email: email,{/if}
					{if $reply['isaddress']}address: address,{/if}
					{if $reply['isgender']}gender: gender,{/if}
					{if $reply['istelephone']}telephone: telephone,{/if}
					{if $reply['isidcard']}idcard: idcard,{/if}
					{if $reply['iscompany']}company: company,{/if}
					{if $reply['isoccupation']}occupation: occupation,{/if}
					{if $reply['isposition']}position: position,{/if}
            };
           	$.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
			if (data.success == true) {
				$("#result_info").html("<br/><br/>" + data.msg + "<br/><div id='share_miao'>3秒后自动关闭</div>");
				djstime(3);
				setTimeout(function () {
				    $("#panel_box").hide();
					$("#result_info").hide();
					$("#isfans").text('0');
					isplayed = false;
		            percent = 0;
				},4000)
				return
			} else {
			    $("#result_info_tip").text(data.msg);
				return
			}
			},"json")
        });
/*倒计时*/
function djstime(miao){
	var e1=$("#share_miao").first();
	var i=miao;
	var interval=setInterval(function(){
		e1.html(i+"秒自动关闭");
		$("#share_miao").css("line-height","35px");
		i--;
		if(i<0){
			$("#share_miao").css({cursor:"pointer"});
			$("#share_miao").css("line-height","18px");						
			clearInterval(interval);	
		}
	},1000);
}
</script>
<!-- 微信分享设置 -->
<script>var require = { urlArgs: 'v={php echo date('YmdH');}' };</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="{$_W['siteroot']}app/resource/js/require.js"></script>
<script src="{$_W['siteroot']}app/resource/js/app/config.js"></script>
<script type="text/javascript">
	// jssdk config 对象
	jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
	// 是否启用调试
	jssdkconfig.debug = false;
	
	jssdkconfig.jsApiList = [
		'checkJsApi',
		'onMenuShareTimeline',
		'onMenuShareAppMessage',
		'onMenuShareQQ',
		'onMenuShareWeibo',
		'showOptionMenu'
	];

	wx.config(jssdkconfig);
	require(['jquery', 'util'], function($, util){
		var sharedata = {
	        "imgUrl" : "{$shareimg}",
	        "link" : "{$sharelink}",
	        "desc" : "{$sharedesc}",
	        "title" : "{$sharetitle}"
	    };		
		
		wx.ready(function () {
			wx.showOptionMenu();
			wx.onMenuShareAppMessage({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,			    
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () { 
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});
			wx.onMenuShareTimeline({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,			    
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () { 
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});
			wx.onMenuShareQQ({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,			    
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () { 
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});
			wx.onMenuShareWeibo({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,			    
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () { 
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () { 
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});
			
		});
	});
</script>
</body>
</html>